<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Agamya Cybertech — Metadata Analyzer (Tech Grid Neon)</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{
    --bg:#0A192F; --glow:#00FFFF; --accent:#1E90FF; --card:#071227; --muted:#8fb2d9;
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;background:linear-gradient(180deg, #061226 0%, #071227 100%);color:#e6f7ff;}
  .container{max-width:1100px;margin:18px auto;padding:22px;background:linear-gradient(180deg, rgba(7,18,39,0.6), rgba(4,9,20,0.55));border-radius:12px;box-shadow:0 8px 30px rgba(2,10,22,0.7);border:1px solid rgba(0,255,255,0.06);}
  header{display:flex;align-items:center;gap:14px;padding-bottom:8px}
  .logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,var(--glow),var(--accent));display:flex;align-items:center;justify-content:center;color:#001F2F;font-weight:800;font-family:Orbitron,monospace;box-shadow:0 6px 18px rgba(0,255,255,0.06);border:1px solid rgba(255,255,255,0.04)}
  h1{margin:0;font-family:Orbitron,monospace;font-size:18px;letter-spacing:0.6px}
  p.lead{margin:4px 0 6px;color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:12px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .drop{min-height:220px;border:2px dashed rgba(0,255,255,0.08);display:flex;align-items:center;justify-content:center;flex-direction:column;border-radius:10px;background-image:radial-gradient(circle at 10% 10%, rgba(0,255,255,0.02), transparent 20%);position:relative}
  .drop.hover{border-color:rgba(0,255,255,0.25);box-shadow:0 8px 30px rgba(0,255,255,0.03) inset}
  .btn{background:linear-gradient(90deg,var(--glow),var(--accent));color:#001f2f;padding:8px 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
  input[type=file]{display:none}
  .meta{font-family:monospace;white-space:pre-wrap;background:linear-gradient(180deg, rgba(1,10,20,0.3), rgba(1,10,20,0.2));padding:12px;border-radius:8px;max-height:360px;overflow:auto;border:1px solid rgba(0,255,255,0.03)}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
  .tagline{font-family:Orbitron,monospace;color:var(--glow);font-weight:700}
  .qr{width:100%;height:86px;border-radius:8px;background:linear-gradient(90deg, rgba(0,255,255,0.02), rgba(30,144,255,0.02));display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px}
  .img-preview,.video-preview{max-width:100%;border-radius:8px;margin-top:8px;border:1px solid rgba(255,255,255,0.03)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .muted{color:var(--muted)}
  .tab-buttons{display:flex;gap:8px;margin-bottom:10px}
  .tab{padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.01);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .tab.active{background:linear-gradient(90deg,var(--glow),var(--accent));color:#001f2f;font-weight:700}
  @media(max-width:900px){.grid{grid-template-columns:1fr;}.container{margin:8px;padding:12px}}
</style>
</head>
<body>
<div class="container" role="main">
  <header>
    <div class="logo">AC</div>
    <div>
      <h1>Agamya Cybertech — Metadata Analyzer</h1>
      <p class="lead">Think Before You Post — Tech Grid Neon demo (Client-side, privacy first)</p>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <div class="tab-buttons">
        <div class="tab active" id="tabImage">Image</div>
        <div class="tab" id="tabVideo">Video</div>
      </div>

      <div id="imageArea">
        <div class="drop" id="dropImg">
          <div style="text-align:center">
            <p style="margin:0;font-weight:700;color:var(--glow)">Drag & drop an image here</p>
            <p class="small muted">or</p>
            <label class="btn" for="fileImage" id="chooseImg">Choose Image</label>
            <input id="fileImage" accept="image/*" type="file">
          </div>
          <img id="previewImg" class="img-preview" style="display:none">
        </div>

        <div class="controls">
          <button id="cleanImg" class="btn" title="Create a copy with metadata removed">Clean Metadata (Download)</button>
          <button id="deleteImg" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Delete Upload</button>
          <button id="clearImg" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Clear Data</button>
        </div>

        <div style="margin-top:12px" id="metaAreaImg">
          <div class="small muted">Image Metadata</div>
          <pre class="meta" id="metaImg">No image loaded.</pre>
        </div>
      </div>

      <div id="videoArea" style="display:none">
        <div class="drop" id="dropVid">
          <div style="text-align:center">
            <p style="margin:0;font-weight:700;color:var(--glow)">Drag & drop a video here</p>
            <p class="small muted">or</p>
            <label class="btn" for="fileVideo" id="chooseVid">Choose Video</label>
            <input id="fileVideo" accept="video/*" type="file">
          </div>
          <video id="previewVid" class="video-preview" style="display:none" controls></video>
        </div>

        <div class="controls">
          <button id="cleanVid" class="btn">Clean Metadata (Download)</button>
          <button id="deleteVid" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Delete Upload</button>
          <button id="clearVid" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Clear Data</button>
        </div>

        <div style="margin-top:12px" id="metaAreaVid">
          <div class="small muted">Video Metadata</div>
          <pre class="meta" id="metaVid">No video loaded.</pre>
        </div>
      </div>

    </div>

    <aside class="card">
      <div class="small muted"><strong>Privacy:</strong> This runs on your device. Files are NOT uploaded to any server unless you permit an external CDN to load optional libraries. For full offline usage, download the required libraries (instructions in README).</div>

      <div style="margin-top:12px">
        <div class="small muted"><strong>How to let attendees connect:</strong></div>
        <ol class="small muted">
          <li>Place files in one folder and run <code>python3 -m http.server 8000</code> from the folder.</li>
          <li>Find your laptop IP (see README). Share <code>http://YOUR_IP:8000</code> or print QR.</li>
          <li>Attendees open the URL on their phones — everything runs in-browser.</li>
        </ol>
      </div>

      <div style="margin-top:12px">
        <div class="small muted"><strong>Notes:</strong></div>
        <ul class="small muted">
          <li>Image cleaning: Draws the image on canvas and exports — removes EXIF.</li>
          <li>Video cleaning: Attempts to run ffmpeg.wasm (if present) to remux video without metadata. If ffmpeg is not available, a basic download of the file is provided (no cleaning).</li>
          <li>For full EXIF details, include <code>exifr.min.js</code> in the folder (optional).</li>
        </ul>
      </div>

      <div style="margin-top:12px" class="qr" id="qr">Share: http://YOUR_IP:8000</div>

      <footer style="margin-top:12px">
        <div class="tagline">Think Before You Post</div>
        <div class="muted">Agamya Cybertech • © 2025</div>
      </footer>
    </aside>
  </div>
</div>

<script>
/* Lightweight loader for exifr and ffmpeg.wasm (optional). If not present, app falls back gracefully. */
(async function(){
  async function loadScript(src){
    return new Promise((res)=>{ const s=document.createElement('script'); s.src=src; s.onload=()=>res(true); s.onerror=()=>res(false); document.head.appendChild(s); });
  }
  const localExifr = 'exifr.min.js';
  const cdnExifr = 'https://cdn.jsdelivr.net/npm/exifr/dist/full.umd.min.js';
  await loadScript(localExifr) || await loadScript(cdnExifr);

  const localFfmpeg = 'ffmpeg.min.js';
  const cdnFfmpeg = 'https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js';
  const ffLoaded = await loadScript(localFfmpeg) || await loadScript(cdnFfmpeg);
  if(ffLoaded && window.createFFmpeg){
    window._ffmpeg = window.createFFmpeg({log:false});
    try{ await window._ffmpeg.load(); console.log('ffmpeg ready'); }catch(e){ console.warn('ffmpeg load failed', e); window._ffmpeg = null; }
  } else { window._ffmpeg = null; }
})();
</script>

<script>
/* Main UI logic (images + videos) */
const fileImage = document.getElementById('fileImage');
const fileVideo = document.getElementById('fileVideo');
const previewImg = document.getElementById('previewImg');
const previewVid = document.getElementById('previewVid');
const metaImg = document.getElementById('metaImg');
const metaVid = document.getElementById('metaVid');

const dropImg = document.getElementById('dropImg');
const dropVid = document.getElementById('dropVid');

const cleanImg = document.getElementById('cleanImg');
const deleteImg = document.getElementById('deleteImg');
const clearImg = document.getElementById('clearImg');

const cleanVid = document.getElementById('cleanVid');
const deleteVid = document.getElementById('deleteVid');
const clearVid = document.getElementById('clearVid');

const tabImage = document.getElementById('tabImage');
const tabVideo = document.getElementById('tabVideo');
const imageArea = document.getElementById('imageArea');
const videoArea = document.getElementById('videoArea');

tabImage.addEventListener('click', ()=>{ tabImage.classList.add('active'); tabVideo.classList.remove('active'); imageArea.style.display='block'; videoArea.style.display='none'; });
tabVideo.addEventListener('click', ()=>{ tabVideo.classList.add('active'); tabImage.classList.remove('active'); imageArea.style.display='none'; videoArea.style.display='block'; });

function humanSize(n){ if(!n) return ""; const units=["B","KB","MB","GB"]; let i=0; while(n>1024 && i<units.length-1){ n/=1024; i++; } return n.toFixed(2)+" "+units[i]; }

function showMeta(el, obj){ try{ el.textContent = JSON.stringify(obj, null, 2); }catch(e){ el.textContent = String(obj); } }

async function extractImageMetadata(file){
  const info = { name: file.name, size: humanSize(file.size), type: file.type, lastModified: new Date(file.lastModified).toString() };
  const imgURL = URL.createObjectURL(file);
  const img = new Image();
  img.src = imgURL;
  await img.decode().catch(()=>{});
  info.width = img.naturalWidth || null;
  info.height = img.naturalHeight || null;
  if(window.exifr && window.exifr.parse){
    try{
      const exif = await window.exifr.parse(file, {gps:true, tiff:true, exif:true, ifd0:true, image:true});
      if(exif) info.exif = exif;
      if(exif && exif.gps){
        const {latitude, longitude} = exif.gps;
        if(latitude && longitude) info.location = {latitude, longitude, maps:`https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`};
      }
    }catch(e){ info.exifError = String(e); }
  } else {
    info.note = "exifr not loaded; include exifr.min.js for richer EXIF details.";
  }
  return {info, imgURL};
}

async function handleImageFile(file){
  metaImg.textContent = "Reading…";
  const {info, imgURL} = await extractImageMetadata(file);
  showMeta(metaImg, info);
  previewImg.src = imgURL; previewImg.style.display='block';
  previewImg.onload = ()=>{ URL.revokeObjectURL(imgURL); };
  cleanImg.dataset.fileName = file.name.replace(/\.(?=[^.]+$)/,'-clean.');
  cleanImg.dataset.mime = file.type || 'image/jpeg';
  deleteImg.onclick = ()=>{ fileImage.value=''; previewImg.style.display='none'; metaImg.textContent='No image loaded.'; };
  clearImg.onclick = ()=>{ metaImg.textContent='No image loaded.'; };
}

fileImage.addEventListener('change', (e)=>{ const f = e.target.files[0]; if(f) handleImageFile(f); });
['dragenter','dragover'].forEach(ev=>{ dropImg.addEventListener(ev,(e)=>{ e.preventDefault(); dropImg.classList.add('hover'); });});
['dragleave','drop'].forEach(ev=>{ dropImg.addEventListener(ev,(e)=>{ e.preventDefault(); dropImg.classList.remove('hover'); });});
dropImg.addEventListener('drop',(e)=>{ const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f){ fileImage.files = e.dataTransfer.files; handleImageFile(f);} });

cleanImg.addEventListener('click', async ()=>{
  const files = fileImage.files; if(!files || files.length===0){ alert("Load an image first"); return; }
  const file = files[0];
  const img = new Image();
  const url = URL.createObjectURL(file); img.src = url; await img.decode().catch(()=>{});
  const canvas = document.createElement('canvas'); canvas.width = img.naturalWidth || img.width; canvas.height = img.naturalHeight || img.height;
  const ctx = canvas.getContext('2d'); ctx.drawImage(img,0,0);
  const mime = (file.type && file.type.startsWith('image/png')) ? 'image/png' : 'image/jpeg';
  canvas.toBlob((blob)=>{ const a=document.createElement('a'); const cleanedName = (file.name || 'image').replace(/\.(?=[^.]+$)/,'-clean.'); a.href = URL.createObjectURL(blob); a.download = cleanedName; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }, mime, 0.92);
});

// VIDEO HANDLERS
async function extractVideoMetadata(file){
  const info = { name: file.name, size: humanSize(file.size), type: file.type, lastModified: new Date(file.lastModified).toString() };
  const url = URL.createObjectURL(file);
  info.url = url;
  // Basic HTML5 metadata
  await new Promise((res)=>{ const v = document.createElement('video'); v.preload='metadata'; v.src = url; v.onloadedmetadata = ()=>{ info.duration = v.duration; info.width = v.videoWidth; info.height = v.videoHeight; res(); }; v.onerror = ()=>{ res(); }; });
  if(window._ffmpeg){
    try{
      const { _ffmpeg } = window;
      const name = 'input.' + (file.name.split('.').pop() || 'mp4');
      const data = await file.arrayBuffer();
      _ffmpeg.FS('writeFile', name, new Uint8Array(data));
      await _ffmpeg.run('-i', name);
      info.ffmpeg = 'probe attempted';
      _ffmpeg.FS('unlink', name);
    }catch(e){ info.ffmpegError = String(e); }
  } else {
    info.note = "ffmpeg.wasm not loaded; include ffmpeg scripts for deeper video metadata and cleaning.";
  }
  return info;
}

async function handleVideoFile(file){
  metaVid.textContent = "Reading…";
  const info = await extractVideoMetadata(file);
  showMeta(metaVid, info);
  previewVid.src = info.url; previewVid.style.display='block';
  deleteVid.onclick = ()=>{ fileVideo.value=''; previewVid.pause(); previewVid.src=''; previewVid.style.display='none'; metaVid.textContent='No video loaded.'; };
  clearVid.onclick = ()=>{ metaVid.textContent='No video loaded.'; };
}

fileVideo.addEventListener('change', (e)=>{ const f = e.target.files[0]; if(f) handleVideoFile(f); });
['dragenter','dragover'].forEach(ev=>{ dropVid.addEventListener(ev,(e)=>{ e.preventDefault(); dropVid.classList.add('hover'); });});
['dragleave','drop'].forEach(ev=>{ dropVid.addEventListener(ev,(e)=>{ e.preventDefault(); dropVid.classList.remove('hover'); });});
dropVid.addEventListener('drop',(e)=>{ const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f){ fileVideo.files = e.dataTransfer.files; handleVideoFile(f);} });

cleanVid.addEventListener('click', async ()=>{
  const files = fileVideo.files; if(!files || files.length===0){ alert("Load a video first"); return; }
  const file = files[0];
  if(window._ffmpeg){
    try{
      const { _ffmpeg } = window;
      const originalName = 'input.' + (file.name.split('.').pop() || 'mp4');
      const outName = 'output.' + (file.name.split('.').pop() || 'mp4');
      const data = await file.arrayBuffer();
      _ffmpeg.FS('writeFile', originalName, new Uint8Array(data));
      await _ffmpeg.run('-i', originalName, '-map', '0', '-c', 'copy', '-map_metadata', '-1', outName);
      const outData = _ffmpeg.FS('readFile', outName);
      const blob = new Blob([outData.buffer], {type: file.type || 'video/mp4'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = file.name.replace(/\.(?=[^.]+$)/,'-clean.'); document.body.appendChild(a); a.click(); document.body.removeChild(a);
      _ffmpeg.FS('unlink', originalName); _ffmpeg.FS('unlink', outName);
    }catch(e){
      alert('Video cleaning failed: ' + e.message);
    }
  } else {
    alert('ffmpeg.wasm not loaded. For video cleaning, download ffmpeg.wasm JS bundle into this folder or allow CDN access. See README.');
  }
});

</script>
</body>
</html>
